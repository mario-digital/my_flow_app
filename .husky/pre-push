#!/usr/bin/env sh

echo "🧪 Running pre-push checks..."

# Git hygiene checks
if git ls-files --error-unmatch .env >/dev/null 2>&1; then
  echo "❌ Detected tracked .env file. Remove it before pushing."
  exit 1
fi

# Frontend checks
echo "🔍 Linting frontend..."
(cd my_flow_client && bun run lint) || { echo "❌ Frontend linting failed"; exit 1; }

echo "📝 Type checking frontend..."
(cd my_flow_client && bun run typecheck) || { echo "❌ Frontend type check failed"; exit 1; }

echo "🔬 Running frontend tests..."
bun --cwd my_flow_client test || { echo "❌ Frontend tests failed"; exit 1; }

# Backend checks
echo "🐍 Linting backend..."
(cd my_flow_api && uv run ruff check .) || { echo "❌ Backend linting failed"; exit 1; }

echo "🐍 Type checking backend..."
(cd my_flow_api && uv run mypy src/) || { echo "❌ Backend type check failed"; exit 1; }

echo "🐍 Running backend tests..."
./scripts/run_backend_tests.sh || { echo "❌ Backend tests failed"; exit 1; }

echo "✅ All checks passed! Pushing..."
